\documentclass[../../../main.tex]{subfiles}
\begin{document}
Ceci n’est pas une blague. Il s’agit d’une section traitant de la virgule ``,'' en C, à la fois comme
opérateur entre différentes expressions et comme séparateur de déclarations\footnote{Et très honnêtement, ça ne sert pas à grand-chose\dots Mais si jamais, c’est là ! La plupart des sections de ce chapitre sont utiles, mais c'est rigolo d'en mettre une inutile dès le début :)}.
\subsection{La virgule comme opérateur}
\label{sub:la_virgule_comme_op_rateur}
La virgule sert à effectuer des opérations à effets de bord lors de l’écriture d’expressions.

\textbf{Rappel :} Une routine à effet de bord est une routine qui agit autrement que par sa valeur de retour,
c’est-à-dire qui agit en dehors de son environnement local. Par exemple, une routine qui affiche du
texte est une routine à effet de bord. Une routine qui modifie la valeur d’un tableau entré en argument
est une routine à effet de bord.

La virgule permet d'étendre la notion d'effet de bord aux expressions.

La syntaxe est la suivante :
\begin{minted}[linenos=false]{c}
expression = (expr1, ..., exprN);
\end{minted}
Elle est équivalente à :
\begin{minted}[linenos=false]{c}
expr1;
expr2;
...;
expr<N-1>;
expression = exprN;
\end{minted}
Un exemple purement technique consistant à compter le nombre d’assignations à des variables\footnote{On pourra ``cacher'' le comptage par une macro dans la section \ref{sec:directives_de_pr_processeurs_2_}} :
\begin{minted}{c}
#include <stdio.h>
#include <stdio.h>

unsigned int _assign_count = 0;

int main(int argc, char **argv) {
	int a = (_assign_count++, 42);
	int b = (_assign_count++, 64);
	b = (_assign_count++, a + b);
	int c = (_assign_count*b + a);
	printf("Nombre d'assignations : %u\n", _assign_count);
	return EXIT_SUCCESS;
}
\end{minted}
Un second exemple à peine moins inutile pour l’échange de valeur de deux variables :
\begin{minted}[linenos=false]{c}
int a = 42;
int b = 64;
int tmp = (tmp = a, a = b, b = tmp);
print("a = %d et b = %d\n", a, b);
\end{minted}
\textbf{Remarque :} Oublier les parenthèses dans ce deuxième exemple est rédhibitoire puisque le compilateur
va considérer que les variables $a$ et $b$ sont redéfinies dans le même bloc, ce qui amène à une erreur de
compilation.

En particulier, il faut rester attentif à la priorité des opérateurs. D'après le tableau \ref{tab:priorite_operateurs}, la virgule est le moins prioritaire des opérateurs. Ainsi :
\begin{minted}[linenos=false]{c}
int x = 1, 2, 3;
\end{minted}
est incorrect car équivalent à :
\begin{minted}[linenos=false]{c}
(((int x = 1), 2), 3);
\end{minted}
qui n’a pas de sens.
\subsubsection{Expression à partir d'un bloc}
L'opérateur virgule permet d'exécuter des expressions par effet de bord. Mais ces expressions sont assez courtes, alors qu'on voudrait plutôt pouvoir exécuter des blocs de code entier.

Cette technique sera aussi utile pour la définition de macros.

Un bloc de code entre accolades défini un environnement local. On peut en fait transformer ce bloc de code en expression par un parenthésage.
\begin{minted}[linenos=false]{c}
// Ceci est une expression :
({
	// CODE
});
\end{minted}
La valeur de l'expression est la valeur de la dernière ligne :
\begin{minted}[linenos=false]{c}
int sum = ({
	int x = 4;
	int y = 5;
	x + y;
});
// sum = 9
\end{minted}
Le programme suivant est donc syntaxiquement parfaitement valide, compile et s'exécute sans problème :
\begin{minted}[linenos=false]{c}
int result = ({
	printf("Du CODE !\n");
	result = ...; // symbole défini assignation donc 'result' est bien défini ici.
	f(result);
});
\end{minted}
En particulier, un bloc de code ``expressionnisé'' peut être sans problème utilisé par l'opérateur virgule :
\begin{minted}[linenos=false]{c}
(..., ({}), ...); // valide (si le reste l'est)
\end{minted}
\subsection{La virgule comme séparateur}
\label{sub:la_virgule_comme_s_parateur}
La virgule sert également dans un cas déjà observé : la séparation des déclarations de variables.
\begin{minted}[linenos=false]{c}
int a = 3, b = a + 1;
\end{minted}
\subsection{Conclusion}
\label{sub:conclusion}
Ben voilà c’est tout\dots\footnote{J'espère que cette conclusion dithyrambique plaira $\wedge\wedge$}
\end{document}